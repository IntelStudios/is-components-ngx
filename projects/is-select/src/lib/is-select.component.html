<div tabindex="0" (keyup)="mainClick($event)" (click)="scrollToSelected()" class="ui-select-container dropdown open">
  <div [class.ui-disabled]="disabled"></div>
  <div class="ui-select-match">
    <span tabindex="-1" class="btn btn-default btn-secondary form-control ui-select-toggle" (click)="matchClick($event)" style="outline: 0;">
        <span *ngIf="!active" class="ui-select-placeholder text-muted">{{placeholder}}</span>
    <span *ngIf="active" class="ui-select-match-text pull-left" [ngClass]="{'ui-select-allow-clear': allowClear && active}">
      <ng-container [ngTemplateOutlet]="templateOptionSelected || defaultTemplateSelection" [ngTemplateOutletContext]="{$implicit: active, index: 0, item: active}">
      </ng-container>
    </span>
    <i class="glyphicon dropdown-caret pull-right" [ngClass]="{'glyphicon-menu-down': !optionsOpened, 'glyphicon-menu-up': optionsOpened}"></i>
    <a *ngIf="allowClear && active" class="btn-remove" (click)="removeClick($event)">
           <i class="glyphicon glyphicon-remove"></i>
        </a>
    </span>
  </div>
  <!-- options template -->
  <!-- options without groups -->
  <div *ngIf="optionsOpened && !firstItemHasChildren" class="ui-select-choices-container dropdown-menu" role="menu">
    <div class="ui-select-search" [class.hidden-input]="!isSearch">
      <input type="text" autocomplete="false" tabindex="-1" (input)="onSearchChange($event.target.value)" (keydown)="inputEvent($event)" (keyup)="inputEvent($event, true)" [disabled]="disabled" class="form-control" placeholder="{{!active ? placeholder : ''}}">
    </div>
    <i *ngIf="isLoadingOptions" class="fa fa-circle-o-notch fa-spin options-loading"></i>
    <ul class="ui-select-choices" *ngIf="options && options.length > 0">
      <li *ngFor="let o of options" role="menuitem">
        <div class="ui-select-choices-row" [class.active]="isActive(o)" [class.selected]="o.ID == active?.ID" (mouseenter)="selectActive(o)" (click)="selectMatch(o, $event)">
          <a href="javascript:void(0)" class="dropdown-item">
            <ng-container [ngTemplateOutlet]="templateOption || defaultTemplateOption" [ngTemplateOutletContext]="{$implicit: o, index: 0, item: o}">
            </ng-container>
          </a>
        </div>
      </li>
    </ul>
  </div>
  <!-- options with groups -->
  <div *ngIf="optionsOpened && firstItemHasChildren" class="ui-select-choices-container dropdown-menu" role="menu">
    <div class="ui-select-search" [class.hidden-input]="!isSearch">
      <input type="text" autocomplete="false" tabindex="-1" (input)="onSearchChange($event.target.value)" (keydown)="inputEvent($event)" (keyup)="inputEvent($event, true)" [disabled]="disabled" class="form-control" placeholder="{{!active ? placeholder : ''}}">
    </div>
    <i *ngIf="isLoadingOptions" class="fa fa-circle-o-notch fa-spin options-loading"></i>
    <ul *ngIf="options && options.length > 0" class="ui-select-choices" role="menu">
      <li *ngFor="let c of options" role="menuitem">
        <div class="dropdown-header">{{c.Value}}</div>
        <div *ngFor="let o of c.children" class="ui-select-choices-row" [class.active]="isActive(o)" [class.selected]="o.ID == active?.ID" (mouseenter)="selectActive(o)" (click)="selectMatch(o, $event)" [ngClass]="{'disabled': o.disabled === true}">
          <a href="javascript:void(0)" class="dropdown-item">
            <ng-container [ngTemplateOutlet]="templateOption || defaultTemplateOption" [ngTemplateOutletContext]="{$implicit: o, index: 0, item: o}">
            </ng-container>
          </a>
        </div>
      </li>
    </ul>
  </div>
</div>

<!--Default templates-->
<ng-template #defaultTemplateOption let-item="item">
  <div [innerHtml]="sanitize(item.Value)"></div>
</ng-template>

<ng-template #defaultTemplateSelection let-item="item">
  <span [innerHtml]="sanitize(item.Value)"></span>
</ng-template>
